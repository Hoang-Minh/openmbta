<% content_for :header do %>
  <script type="text/javascript">

    var stops = <%= @stops.to_json %>;


  </script>
  <%= javascript_include_tag "jquery-1.3.2.min.js"  %>
  <%= javascript_include_tag "triptable"  %>
<% end %>
<% content_for :body_attr, 'onload="initialize()"' %>

<div class="nav"
  <%= link_to "main", "/mobile" %> &gt; <%= link_to "routes", url_for(:controller => "routes", :transport_type => params[:transport_type]) %> &gt; trips
</div>

<div class="info">
  <span style="font-weight:bold"><%= @headsign %></span><br/>
  <%= route_s @route, @transport_type.to_s %>
</div>

<p>
If your device allows geo-location, the closest stop will be <span class="example-blue">highlighted in blue</span>.
</p>

<p id="closestStopFound"></p>


<div style='float:left;'>
  <% if  @current_offset >= 7 %>
    <%= link_to "&lt;&lt; previous", url_for(params.merge(:offset => @current_offset - 7)) %>

  <% end %>
</div>
<div style='text-align:right;'>
  <% if @all_trip_ids.size >=  @current_offset + 7 %>
    <%= link_to "later &gt;&gt;", url_for(params.merge(:offset => @current_offset + 7)) %>

  <% end %>
</div>

<table class='mbta'>
  <% @result[:ordered_stop_ids].each do |stop_id| %>
    <tr  class='row-header stop-name'>
      <td id="<%=stop_id%>" colspan="7">
        <span class="stop-name-span">
          <%= @result[:stops][stop_id][:name] %>
        </span>
        <span class="stop-detail"><a href="<%= url_for(params.merge(:stop_id => stop_id, :controller => 'stop_arrivals')) %>">detail</a></span>

      </td>
    </tr>
      <% 7.times do |i|  %>
        <% trip_id = @trip_ids[i] %>
        <td class="arrival-time ">
          <% if trip_id %>
            <% next_arrival = @result[:stops][stop_id][:next_arrivals].detect {|x| x[1] == trip_id }  %>
            <% if next_arrival.nil? %>
              &nbsp; 
            <% elsif next_arrival %>
              <%= next_arrival[0] %>
            <% end %>
          <% else %>
            &nbsp;
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>



<%# @result.inspect %> 

